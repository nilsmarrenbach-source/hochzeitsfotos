<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Hochzeit – Menü, Fotos, Quiz & Chat</title>
  <style>
    :root { --bg:#f8f8f8; --fg:#111; --muted:#666; --accent:#000; }
    * { box-sizing:border-box; }
    body { margin:0; font-family: system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, "Helvetica Neue", sans-serif; background:var(--bg); color:var(--fg); text-align:center; }
    header { background:var(--accent); color:#fff; padding:22px 16px; letter-spacing:.3px; }
    header h1 { margin:0; font-weight:700; font-size:24px; }
    nav { display:flex; flex-wrap:wrap; gap:10px; justify-content:center; padding:16px; }
    nav button { appearance:none; border:none; background:var(--accent); color:#fff; padding:10px 16px; border-radius:10px; cursor:pointer; font-weight:600; }
    nav button[aria-current="page"] { outline:2px solid #000; outline-offset:2px; }
    main { max-width:1000px; margin:0 auto; padding:10px 16px 40px; }
    .section { display:none; text-align:left; background:#fff; padding:22px; border-radius:16px; box-shadow:0 6px 20px rgba(0,0,0,.06); margin-top:8px; }
    .section.active { display:block; }
    h2 { margin-top:0; text-align:center; }
    a.btn, .btn { display:inline-block; background:#000; color:#fff; text-decoration:none; padding:10px 16px; border-radius:10px; margin:6px 6px 0; }
    .grid2 { display:grid; grid-template-columns:1fr; gap:18px; }
    @media (min-width:700px){ .grid2 { grid-template-columns:1fr 1fr; } }
    iframe { width:100%; height:70vh; border:none; background:#f1f1f1; border-radius:12px; }
    /* Quiz */
    .question { padding:12px 14px; border:1px solid #e7e7e7; border-radius:10px; margin-bottom:12px; }
    .answers label { display:block; margin:6px 0; }
    .muted { color:var(--muted); font-size:.95rem; }
    ul#scoreboard { list-style:none; padding:0; margin:0; }
    ul#scoreboard li { padding:8px 10px; border-bottom:1px dashed #e5e5e5; display:flex; justify-content:space-between; }
    /* Chat */
    #messages { height:340px; overflow:auto; border:1px solid #e7e7e7; border-radius:12px; padding:12px; background:#fafafa; }
    .msg { text-wrap: pretty; padding:6px 8px; margin:6px 0; border-radius:8px; background:#fff; border:1px solid #efefef; }
    .msg .meta { font-size:.8rem; color:#777; }
    .row { display:flex; gap:8px; align-items:center; }
    input[type="text"], textarea { width:100%; padding:10px 12px; border:1px solid #ddd; border-radius:10px; font:inherit; }
    .note { color:#999; font-size:.9rem; text-align:center; }
  </style>
</head>
<body>
  <header>
    <h1>Willkommen zur Hochzeit – Menü, Fotos, Quiz & Chat</h1>
  </header>

  <nav aria-label="Hauptnavigation">
    <button onclick="show('fotos', this)" aria-current="page">📸 Fotos</button>
    <button onclick="show('speisekarte', this)">🍽️ Speisekarte</button>
    <button onclick="show('rede', this)">💬 Hochzeitsrede</button>
    <button onclick="show('quiz', this)">❓ Quiz</button>
    <button onclick="show('chat', this)">💬 Chat</button>
    <button onclick="show('gaesteantworten', this)">📝 Über uns</button>
  </nav>

  <main>
    <!-- Fotos -->
    <section id="fotos" class="section active">
      <h2>📷 Fotos hochladen oder ansehen</h2>
      <p class="muted" style="text-align:center">Wählt eine Option:</p>
      <div class="grid2" style="text-align:center">
        <div>
          <h3>Hochladen</h3>
          <p>Teile eure schönsten Momente mit uns!</p>
          <a class="btn" target="_blank" href="https://www.dropbox.com/request/yq0IJGtF4kC2J1Cfqyg3">📥 Fotos hochladen</a>
        </div>
        <div>
          <h3>Ansehen & Herunterladen</h3>
          <p>Alle Bilder der Gäste an einem Ort.</p>
          <a class="btn" target="_blank" href="https://www.dropbox.com/scl/fo/2avn44dduw9frc86a2vuc/ADTyW_6937n1flsezIGobfQ?rlkey=si7t1g01cc8e8moy5oeahb6bo&st=8l1z0tg5&dl=0">📤 Fotos ansehen</a>
        </div>
      </div>
    </section>

    <!-- Speisekarte -->
    <section id="speisekarte" class="section">
      <h2>🍽️ Speisekarte</h2>
      <p class="note">Lege eine Datei <code>speisekarte.pdf</code> in dein Repo. Falls sie fehlt, erscheint unten eine Notiz.</p>
      <iframe id="menuFrame" src="speisekarte.pdf" title="Speisekarte"></iframe>
      <div id="menuFallback" class="note" style="display:none;">Speisekarte nicht gefunden (speisekarte.pdf).</div>
    </section>

    <!-- Rede -->
    <section id="rede" class="section">
      <h2>💬 Hochzeitsrede</h2>
      <p class="note">Lege eine Datei <code>hochzeitsrede.pdf</code> in dein Repo.</p>
      <iframe id="speechFrame" src="hochzeitsrede.pdf" title="Hochzeitsrede"></iframe>
      <div id="speechFallback" class="note" style="display:none;">Hochzeitsrede nicht gefunden (hochzeitsrede.pdf).</div>
    </section>

    <!-- Quiz -->
    <section id="quiz" class="section">
      <h2>❓ Hochzeitsquiz</h2>
      <div id="quiz-login">
        <p>Gib deinen Namen ein, um am Quiz teilzunehmen:</p>
        <div class="row" style="justify-content:center">
          <input type="text" id="username" placeholder="Dein Name" style="max-width:360px;" />
          <button class="btn" onclick="startQuiz()">Quiz starten</button>
        </div>
      </div>
      <form id="quiz-form" style="display:none">
        <div id="questions"></div>
        <div style="text-align:center; margin-top:12px">
          <button class="btn" type="submit">Antworten absenden</button>
        </div>
      </form>
      <div id="result" style="display:none; text-align:center; font-weight:600; margin-top:14px"></div>

      <div class="scoreboard">
        <h3 style="text-align:center">🏆 Rangliste</h3>
        <ul id="scoreboard"></ul>
      </div>
    </section>

    <!-- Chat -->
    <section id="chat" class="section">
      <h2>💬 Hochzeitschat</h2>
      <div id="chat-login" class="row" style="justify-content:center; margin-bottom:12px;">
        <input type="text" id="chatName" placeholder="Dein Name" style="max-width:360px;" />
        <button class="btn" onclick="joinChat()">Chat betreten</button>
      </div>
      <div id="chatBox" style="display:none;">
        <div id="messages"></div>
        <div class="row" style="margin-top:10px;">
          <input type="text" id="messageInput" placeholder="Deine Nachricht" />
          <button class="btn" onclick="sendMessage()">Senden</button>
        </div>
      </div>
    </section>

    <!-- Über uns -->
    <section id="gaesteantworten" class="section">
      <h2>📝 Über uns</h2>
      <p class="muted">Schreib eine kurze Zeile – was macht <strong>Lea</strong> und was macht <strong>Nils</strong> aus?</p>
      <div class="row" style="margin-bottom:8px;">
        <input id="aboutName" type="text" placeholder="Dein Name (optional)" />
      </div>
      <div class="grid2">
        <div>
          <h3>Zu Lea</h3>
          <textarea id="aboutLea" rows="4" placeholder="Dein Satz zu Lea..."></textarea>
        </div>
        <div>
          <h3>Zu Nils</h3>
          <textarea id="aboutNils" rows="4" placeholder="Dein Satz zu Nils..."></textarea>
        </div>
      </div>
      <div style="text-align:center; margin-top:10px;">
        <button class="btn" onclick="submitAbout()">Absenden</button>
      </div>
      <div style="margin-top:16px;">
        <h3 style="text-align:center">Eure Antworten (live)</h3>
        <div id="aboutList" class="grid2"></div>
      </div>
    </section>
  </main>

  <!-- Navigation & Fallbacks: bewusst in normalem Script, damit die Seite bedienbar bleibt -->
  <script>
    function show(id, btn){
      document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
      document.getElementById(id).classList.add('active');
      document.querySelectorAll('nav button').forEach(b => b.removeAttribute('aria-current'));
      if(btn) btn.setAttribute('aria-current', 'page');
    }
    // PDF-Fallbacks
    window.addEventListener('load', () => {
      const mf = document.getElementById('menuFrame');
      const sf = document.getElementById('speechFrame');
      if (mf) mf.addEventListener('error', () => document.getElementById('menuFallback').style.display='block');
      if (sf) sf.addEventListener('error', () => document.getElementById('speechFallback').style.display='block');
      // Safari lädt PDF-iframe-Fehler nicht immer als 'error' – als Workaround nach 1s prüfen:
      setTimeout(()=>{
        if (mf && mf.contentDocument === null) document.getElementById('menuFallback').style.display='block';
        if (sf && sf.contentDocument === null) document.getElementById('speechFallback').style.display='block';
      }, 1200);
    });
  </script>

  <!-- App-Logik & Firebase (modular) -->
  <script type="module">
    // === Firebase ES Modules (nutze eine aktuelle 10.x-Version) ===
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
    import { getDatabase, ref, push, onChildAdded } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-database.js";

    // === Quizfragen (deine 10) ===
    const questions = [
      { q:'Welches Haushaltsgerät wird von Lea täglich genutzt und treibt Nils in den Wahnsinn?', a:['Trockner','Staubsauger','Wasserkocher'], correct:'Staubsauger' },
      { q:'Wann sind Lea und Nils zusammengekommen?', a:['08.03.2017','18.03.2018','28.03.2017'], correct:'28.03.2017' },
      { q:'Wer von deren Freunden war beim ersten Date anwesend?', a:['Theresa','Lea-Stutzinger','Markus'], correct:'Theresa' },
      { q:'Welche Handgeste hat Lea ihrem Schwiegervater beim ersten Kennenlernen zur Begrüßung gezeigt?', a:['Peacezeichen','Gewinkt','High 5'], correct:'Peacezeichen' },
      { q:'Was war Nils schlimmstes Verbrechen bei seinen Schwiegereltern?', a:['nichtabgespült nach langer Toilettensitzung','aus dem Dachfenster übergeben','Ollis Schraubschlüssel geliehen und nie wiedergegeben'], correct:'aus dem Dachfenster übergeben' },
      { q:'Welche Krankheit schreibt Lea Nils zu?', a:['Autismus','Achs','Zwangsstörung'], correct:'Autismus' },
      { q:'Zu was wird Lea wenn sie schlecht gelaunt ist?', a:['dem unglaublichen Hulk','Giftzwerg','Fruchtzwerg'], correct:'Giftzwerg' },
      { q:'Wie lautet Nils legendärer durch seine Mutter vergebener Spitzname?', a:['bübchen','mamabärchen','püppelmann'], correct:'püppelmann' },
      { q:'Was ist Nils und Leas Einrichtungssteal?', a:['Antik','modern','Eklektizismus'], correct:'Eklektizismus' },
      { q:'Wer hat zuhause die Hosen an?', a:['Lea','Nils','Beide'], correct:'Beide' },
    ];

    // === Firebase-Konfig (Bucket auf appspot.com) ===
    const firebaseConfig = {
      apiKey: "AIzaSyDEYeCmTkVGf4pTLCS-s3fV9jo1ivVPMj8",
      authDomain: "hochzeitschat.firebaseapp.com",
      databaseURL: "https://hochzeitschat-default-rtdb.europe-west1.firebasedatabase.app",
      projectId: "hochzeitschat",
      storageBucket: "hochzeitschat.appspot.com",
      messagingSenderId: "180005609648",
      appId: "1:180005609648:web:f8c8cd278a1e3830501b75"
    };

    // Init
    const app = initializeApp(firebaseConfig);
    const db  = getDatabase(app);

    // === QUIZ ===
    let quizUser = "";
    window.startQuiz = () => {
      const name = (document.getElementById('username')?.value || "").trim();
      if (!name) return alert("Bitte gib einen Namen ein.");
      quizUser = name;

      const container = document.getElementById('questions');
      container.innerHTML = "";
      questions.forEach((q,i) => {
        const div = document.createElement('div');
        div.className = 'question';
        div.innerHTML = `<p><strong>${i+1}.</strong> ${q.q}</p>`;
        const opts = q.a.map(ans => `<label><input type="radio" name="q${i}" value="${ans}"> ${ans}</label>`).join('');
        const answers = document.createElement('div');
        answers.className = 'answers';
        answers.innerHTML = opts;
        div.appendChild(answers);
        container.appendChild(div);
      });

      document.getElementById('quiz-login').style.display = 'none';
      document.getElementById('quiz-form').style.display = 'block';
    };

    document.getElementById('quiz-form')?.addEventListener('submit', (e) => {
      e.preventDefault();
      const data = new FormData(e.target);
      let score = 0;
      questions.forEach((q,i) => { if (data.get(`q${i}`) === q.correct) score++; });

      push(ref(db, 'scores'), { name: quizUser, score, total: questions.length, ts: Date.now() });

      e.target.style.display = 'none';
      const res = document.getElementById('result');
      res.style.display = 'block';
      res.textContent = `${quizUser}, du hast ${score} von ${questions.length} Punkten erreicht!`;
    });

    const sbEl = document.getElementById('scoreboard');
    const scores = [];
    onChildAdded(ref(db, 'scores'), (snap) => {
      const v = snap.val();
      scores.push(v);
      const sorted = [...scores].sort((a,b) => b.score - a.score || a.ts - b.ts);
      sbEl.innerHTML = sorted.map((s,i)=>`<li><span>${i+1}. ${s.name}</span><strong>${s.score}/${s.total}</strong></li>`).join('');
    });

    // === CHAT ===
    let chatUser = "";
    window.joinChat = () => {
      const n = (document.getElementById('chatName')?.value || "").trim();
      if (!n) return alert("Bitte gib einen Namen ein.");
      chatUser = n;
      document.getElementById('chat-login').style.display = 'none';
      document.getElementById('chatBox').style.display = 'block';
    };

    window.sendMessage = () => {
      const inp = document.getElementById('messageInput');
      const msg = (inp?.value || "").trim();
      if (!msg || !chatUser) return;
      push(ref(db, 'messages'), { name: chatUser, message: msg, ts: Date.now() });
      inp.value = "";
    };

    const messagesEl = document.getElementById('messages');
    onChildAdded(ref(db, 'messages'), (snap) => {
      const m = snap.val();
      const time = new Date(m.ts).toLocaleTimeString([], {hour:'2-digit', minute:'2-digit'});
      const div = document.createElement('div');
      div.className = 'msg';
      div.innerHTML = `<div class="meta">[${time}] <strong>${m.name}</strong></div><div>${m.message}</div>`;
      messagesEl.appendChild(div);
      messagesEl.scrollTop = messagesEl.scrollHeight;
    });

    // === ÜBER UNS ===
    window.submitAbout = () => {
      const lea  = (document.getElementById('aboutLea')?.value || "").trim();
      const nils = (document.getElementById('aboutNils')?.value || "").trim();
      const from = (document.getElementById('aboutName')?.value || "").trim();
      if (!lea && !nils) return alert("Bitte schreibe etwas zu Lea oder Nils.");
      if (lea)  push(ref(db, 'about'), { who:'Lea',  text: lea,  from, ts: Date.now() });
      if (nils) push(ref(db, 'about'), { who:'Nils', text: nils, from, ts: Date.now() });
      const l = document.getElementById('aboutLea');  if (l) l.value = "";
      const n = document.getElementById('aboutNils'); if (n) n.value = "";
      const f = document.getElementById('aboutName'); if (f) f.value = "";
    };

    const aboutList = document.getElementById('aboutList');
    onChildAdded(ref(db, 'about'), (snap) => {
      const v = snap.val();
      const card = document.createElement('div');
      card.className = 'question';
      const from = v.from ? ` – <span class="muted">von ${v.from}</span>` : '';
      card.innerHTML = `<strong>${v.who}</strong>${from}<div style="margin-top:6px;">${v.text}</div>`;
      aboutList.appendChild(card);
    });
  </script>
</body>
</html>

